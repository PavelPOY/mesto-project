(()=>{"use strict";var e={},t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-16",headers:{authorization:"ac490a89-f995-48f9-b5f2-220c6032f771","Content-Type":"application/json"}};function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}function r(e){"Escape"===e.key&&o(document.querySelector(".popup_opened"))}function c(e){e.target.classList.contains("popup")&&o(e.target)}function u(o,r,c,u,a){var i=r.cloneNode(!0),s=i.querySelector(".elements__title"),l=i.querySelector(".elements__button"),d=i.querySelector(".elements__like"),m=i.querySelector(".elements__button-delete"),f=i.querySelector(".elements__image");return s.textContent=o.name,f.src=o.link,f.alt=o.name,d.textContent=o.likes.length,function(t){return t.likes.some((function(t){return t._id===e.id}))}(o)&&l.classList.add("elements__button_active"),l.addEventListener("click",(function(e){var n;e.target.classList.contains("elements__button_active")?(n=o._id,fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){e.target.classList.toggle("elements__button_active"),d.textContent=t.likes.length})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(o._id).then((function(t){e.target.classList.toggle("elements__button_active"),d.textContent=t.likes.length})).catch((function(e){return console.log(e)}))})),e.id!==o.owner._id?m.style.visibility="hidden":m.addEventListener("click",(function(e){var n;(n=o._id,fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){e.target.closest(".elements__card").remove()})).catch((function(e){return console.log(e)}))})),f.addEventListener("click",(function(){n(c),a.textContent=o.name,u.src=o.link,u.alt=o.name})),i}function a(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}function i(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){a(e,n,t)}))}function s(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}var l=document.querySelectorAll(".popup__close-button"),d=document.querySelectorAll(".popup"),m=document.querySelector("#profile"),f=document.querySelector(".profile__name"),p=document.querySelector(".profile__about"),h=document.querySelector('[name="profile-name"]'),_=document.querySelector('[name="profile-about"]'),v=document.querySelector('[name="profile-form"]'),y=document.querySelector(".profile__edit-button"),S=v.querySelector('button[type="submit"]'),b=document.querySelector("#avatar"),q=document.querySelector(".profile__image"),E=document.querySelector('[name="profile-avatar-input"]'),L=document.querySelector('[name="profile-avatar-form"]'),g=document.querySelector(".profile__avatar-button"),k=L.querySelector('button[type="submit"]'),C=document.querySelector("#card"),j=document.querySelector(".elements"),x=document.querySelector(".profile__add-button"),P=document.querySelector('[name="card-name"]'),T=document.querySelector('[name="card-about"]'),A=document.querySelector('[name="card-form"]'),U=document.querySelector("#elements__template").content,B=A.querySelector('button[type="submit"]'),D=document.querySelector("#image"),N=document.querySelector(".popup__image"),O=document.querySelector(".popup__image-caption"),w={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup_error_visible"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);s(n,o,t),e.addEventListener("reset",(function(){setTimeout((function(){s(n,o,t)}),0)})),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?a(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),s(n,o,t)}))}))}(t,e)}))}(w),Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{method:"GET",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(t.baseUrl,"/cards"),{method:"GET",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(t){!function(t){f.textContent=t.name,p.textContent=t.about,e.id=t._id,q.src=t.avatar}(t[0]),t[1].forEach((function(e){return j.append(u(e,U,D,N,O))}))})).catch((function(e){return console.log(e)})),v.addEventListener("submit",(function(e){var n,r;e.preventDefault(),S.textContent="Сохранение...",(n=h.value,r=_.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){f.textContent=e.name,p.textContent=e.about})).catch((function(e){return console.log(e)})).finally((function(){return setTimeout((function(){return S.textContent="Сохранить"}),1e4)})),o(m)})),A.addEventListener("submit",(function(e){var n,r;e.preventDefault(),B.textContent="Создание...",(n=P.value,r=T.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n,link:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){!function(e){j.prepend(u(e,U,D,N,O))}(e)})).catch((function(e){return console.log(e)})).finally((function(){return setTimeout((function(){return B.textContent="Создать"}),1e4)})),A.reset(),o(C)})),L.addEventListener("submit",(function(e){var n;e.preventDefault(),k.textContent="Сохранение...",(n=E.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){q.src=e.avatar})).catch((function(e){return console.log(e)})).finally((function(){return setTimeout((function(){return k.textContent="Сохранить"}),1e4)})),o(b)})),y.addEventListener("click",(function(){i(v,w),n(m)})),x.addEventListener("click",(function(){i(A,w),n(C)})),g.addEventListener("click",(function(){i(L,w),n(b)})),l.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return o(t)}))})),d.forEach((function(e){e.addEventListener("click",c)}))})();